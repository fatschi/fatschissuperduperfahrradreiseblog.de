<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>fatschissuperduperfahrradreiseblog.de</title>
    <link rel="icon" type="image/png" href="img/favicon.png" />
    <link rel="stylesheet" href="css/style.css">
    <script type="text/javascript" src="js/instafeed.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha256-k2WSCIexGzOj3Euiig+TlR8gA0EmPjuc79OEeY5L45g="
        crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            var imageMap = {};
            var isPlaying = true;
            var latitude, longitude;
            var feed = new Instafeed({
                get: 'user',
                userId: '4725130256',
                accessToken: '4725130256.1677ed0.3eddbc3d1f0e458486c8f9a99f449552',
                resolution: 'standard_resolution',
                template: '<div class="image" style="background-image: url({{image}})"><a class="captionLink" target="_blank" href="{{link}}"><div class="caption"><div class="captionText">{{caption}}</div></div></a></div>',
                sortBy: 'most-recent',
                links: true,
                filter: function (image) {
                    var isBlogPicture = image.tags.indexOf('fatschissuperduperfahrradreiseblog') >= 1;
                    if (isBlogPicture) {
                        var imageFile = image.images.standard_resolution;
                        imageMap['url("' + imageFile.url + '")'] = imageFile.width / imageFile.height;
                        image.caption.text = image.caption.text.replace(
                            '#fatschissuperduperfahrradreiseblog', "");
                        if (!latitude && image.location) {
                            latitude = image.location.latitude;
                            longitude = image.location.longitude;
                        }
                    }
                    return isBlogPicture;
                },
                after: function () {
                    if (feed.hasNext()) {
                        feed.next();
                    } else {
                        setTimeout(function () {
                            $(document).scrollLeft(0);
                            var step = function () {
                                if (isPlaying) {
                                    $(document).scrollLeft($(document).scrollLeft() + 1);
                                    paralax($('#cloud1'), 0.11);
                                    paralax($('#cloud2'), 0.79);
                                    paralax($('#cloud3'), 0.28);
                                }
                                requestAnimationFrame(step);
                            };

                            var mapDiv = $("<div/>");
                            mapDiv.addClass("image");
                            var imageUrl =
                                'http://maps.googleapis.com/maps/api/staticmap?zoom=6&size=320x640&maptype=hybrid&markers=icon:https://fatschi.github.io/img/favicon_small.png|' +
                                latitude + ',' + longitude;
                            mapDiv.css("background-image", "url(" + imageUrl + ")");
                            $("#instafeed").children(':eq(0)').after(mapDiv);
                            imageMap['url("' + imageUrl + '")'] = 0.5;

                            $(".image").each(function (index, element) {
                                var url = $(element).css("background-image");
                                var scaleFactor = imageMap[url] || 1;
                                $(element).width($(element).width() * scaleFactor);
                            });

                            $(".ground").width($(document).width());

                            $('#overlay').addClass('hide');

                            requestAnimationFrame(step);
                        }, 0)
                    }
                }
            });
            feed.run();

            $(".playpause").click(function () {
                isPlaying = !isPlaying;
                $(".playpause").toggleClass("pause");
            });
            $(document).on("mousewheel", function (e, delta) {
                $(window).scrollLeft($(window).scrollLeft() + (e.originalEvent.wheelDelta * -0.3));
                e.preventDefault();
            });
        });

        function paralax(element, factor) {
            element.css('left', element.position().left - factor);
        }
    </script>
</head>

<body>
    <div id="overlay">
        <img class="loading" src="img/face_loading.gif">
    </div>
    <div id="wrapper">
        <div class="bubble">
            <div class="playpause"></div>
        </div>
        <div class="ground"></div>
        <div class="char"></div>
        <div id="cloud1"></div>
        <div id="cloud2"></div>
        <div id="cloud3"></div>
        <div id="loading"></div>
        <div id="instafeed"></div>
    </div>
</body>

</html>